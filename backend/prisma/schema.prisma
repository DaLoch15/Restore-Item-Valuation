generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String
  passwordHash String    @map("password_hash")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  projects     Project[]

  @@map("users")
}

model Project {
  id          String        @id @default(cuid())
  userId      String        @map("user_id")
  name        String
  description String?
  status      ProjectStatus @default(DRAFT)
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  folders      Folder[]
  analysisJobs AnalysisJob[]

  @@map("projects")
}

enum ProjectStatus {
  DRAFT
  READY
  PROCESSING
  COMPLETED
  ARCHIVED
}

model Folder {
  id           String   @id @default(cuid())
  projectId    String   @map("project_id")
  name         String
  roomType     String?  @map("room_type")
  displayOrder Int      @default(0) @map("display_order")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  photos  Photo[]

  @@map("folders")
}

model Photo {
  id           String      @id @default(cuid())
  folderId     String      @map("folder_id")
  fileName     String      @map("file_name")
  originalName String      @map("original_name")
  storagePath  String      @map("storage_path")
  storageUrl   String      @map("storage_url")
  mimeType     String      @map("mime_type")
  fileSize     Int         @map("file_size")
  thumbnailUrl String?     @map("thumbnail_url")
  status       PhotoStatus @default(UPLOADED)
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")

  folder Folder @relation(fields: [folderId], references: [id], onDelete: Cascade)

  @@map("photos")
}

enum PhotoStatus {
  UPLOADING
  UPLOADED
  PROCESSING
  PROCESSED
  ERROR
}

model AnalysisJob {
  id              String         @id @default(cuid())
  projectId       String         @map("project_id")
  status          AnalysisStatus @default(PENDING)
  triggeredAt     DateTime?      @map("triggered_at")
  startedAt       DateTime?      @map("started_at")
  completedAt     DateTime?      @map("completed_at")
  errorMessage    String?        @map("error_message")
  resultsSummary  Json?          @map("results_summary")
  sheetUrl        String?        @map("sheet_url")
  pdfUrl          String?        @map("pdf_url")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("analysis_jobs")
}

enum AnalysisStatus {
  PENDING
  TRIGGERED
  PROCESSING
  COMPLETED
  FAILED
}
